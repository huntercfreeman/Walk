@using Walk.Common.RazorLib.Contexts.Displays
@using Walk.Common.RazorLib.Contexts.Models;
@using Walk.Common.RazorLib.Dimensions.Models;
@using Walk.Common.RazorLib.Installations.Displays
@using Walk.Common.RazorLib.Panels.Displays
@using Walk.Common.RazorLib.Panels.Models;
@using Walk.Common.RazorLib.Resizes.Displays
@using Walk.Ide.RazorLib.Installations.Displays
@using Walk.Ide.RazorLib.Shareds.Displays.Internals
@using Walk.TextEditor.RazorLib.Installations.Displays

@inherits LayoutComponentBase

@{
    var uiStringBuilder = CommonBackgroundTaskApi.UiStringBuilder;
    
    uiStringBuilder.Clear();
    uiStringBuilder.Append("di_ide_main-layout ");
    uiStringBuilder.Append(UnselectableClassCss);
    uiStringBuilder.Append(" ");
    uiStringBuilder.Append(AppOptionsService.ThemeCssClassString);
    uiStringBuilder.Append(" ");
    uiStringBuilder.Append(TextEditorService.ThemeCssClassString);
    var classCssString = uiStringBuilder.ToString();
    
    uiStringBuilder.Clear();
    uiStringBuilder.Append(AppOptionsService.FontSizeCssStyleString);
    uiStringBuilder.Append(" ");
    uiStringBuilder.Append(AppOptionsService.FontFamilyCssStyleString);
    uiStringBuilder.Append(" ");
    uiStringBuilder.Append(AppOptionsService.ColorSchemeCssStyleString);
    var styleCssString = uiStringBuilder.ToString();
}

<ContextBoundary ContextRecord="ContextFacts.GlobalContext"
                 ClassCssString="@classCssString"
                 StyleCssString="@styleCssString">

    <Walk.Common.RazorLib.Drags.Displays.DragInitializer />
    <WalkCommonInitializer />
    <WalkTextEditorInitializer />
    <WalkIdeInitializer />

    <IdeHeader/>
    
    <IdeBody BodyElementDimensions="_bodyElementDimensions" />

    <ResizableRow TopElementDimensions="_bodyElementDimensions"
                  BottomElementDimensions="PanelFacts.GetBottomPanelGroup(PanelService.GetPanelState()).ElementDimensions"
                  ReRenderFuncAsync="() => InvokeAsync(StateHasChanged)" />

    <PanelGroupDisplay PanelGroupKey="PanelFacts.BottomPanelGroupKey"
                  CssClassString="di_ide_footer"
                  AdjacentElementDimensions="_bodyElementDimensions"
                  DimensionAttributeKind="DimensionAttributeKind.Height"
                  ReRenderSelfAndAdjacentElementDimensionsFunc="() => InvokeAsync(StateHasChanged)">

        <JustifyEndRenderFragment>
        	@{ var ideMainLayoutState = IdeMainLayoutService.GetIdeMainLayoutState(); }
        	
        	@foreach (var footerJustifyEndComponent in ideMainLayoutState.FooterJustifyEndComponentList)
        	{
        		<DynamicComponent Type="footerJustifyEndComponent.ComponentType"
        						  Parameters="footerJustifyEndComponent.ComponentParameterMap"/>
        	}
        </JustifyEndRenderFragment>
    </PanelGroupDisplay>
</ContextBoundary>